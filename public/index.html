<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>DM Screen</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&family=Merriweather:wght@400;700;900&display=swap" rel="stylesheet">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack/dist/gridstack.min.css" />

<link rel="stylesheet" href="style.css">

<script src="https://cdn.jsdelivr.net/npm/gridstack/dist/gridstack-all.js"></script>
<script src="data.js" defer></script>
<script src="shared.js" defer></script>
<script src="main.js" defer></script>
</head>
<body>

<div class="container">
  <div class="header" id="app-header">
    <div class="header-top">
      <div class="header-left">
        <div id="game-title-container">
          <select id="game-select" aria-label="Valitse pelij√§rjestelm√§">
            <option value="Dread Nights">Dread Nights</option>
            <option value="Placeholder">Placeholder Game</option>
          </select>
        </div>
      </div>

      <div class="header-right top-controls">
        <!-- Core player preview button (not game-specific) -->
        <button id="open-player-link-btn" class="btn btn-secondary">
          <i class="fas fa-link"></i>
        </button>

        <button id="toggle-map-btn" class="btn btn-secondary" aria-pressed="false">
          <i class="fas fa-map"></i>
        </button>
      </div>
    </div>

    <div class="header-inner" id="app-header-inner">
      <div class="game-actions-row">
        <div class="header-right" id="game-actions">
          <!-- Game-specific actions injected here by JS (e.g., Kauppa for Dread Nights) -->
        </div>
      </div>

      <div id="merchant-mode-indicator" class="merchant-mode-indicator hidden">
        <span>Merchant Mode Active</span>
        <button id="disable-merchant-mode" class="btn btn-sm btn-danger">Disable</button>
      </div>
    </div>

    <button id="toggle-header-btn" class="btn btn-secondary header-toggle" aria-expanded="true" aria-controls="app-header-inner">
      <i class="fas fa-chevron-up"></i>
    </button>
  </div>

  <div class="tabs">
    <button class="tab-button active" data-tab="tab-prep">Session Start</button>
  </div>

  <div id="tab-prep" class="tab-content active">
    <div id="dread-nights-active-screen">
      <div class="prep-layout">
      <div class="prep-roadmap">
        <div class="prep-roadmap-step active" data-step="1">
          <span class="step-number">1</span>
          <span class="step-title">Killat</span>
        </div>
        <div class="prep-roadmap-step" data-step="2">
          <span class="step-number">2</span>
          <span class="step-title">Killan nimi</span>
        </div>
        <div class="prep-roadmap-step" data-step="3">
          <span class="step-number">3</span>
          <span class="step-title">Nimet</span>
        </div>
        <div class="prep-roadmap-step" data-step="4">
          <span class="step-number">4</span>
          <span class="step-title">Ty√∂nkuvat</span>
        </div>
        <div class="prep-roadmap-step" data-step="5">
          <span class="step-number">5</span>
          <span class="step-title">Stats</span>
        </div>
        <div class="prep-roadmap-step" data-step="6">
          <span class="step-number">6</span>
          <span class="step-title">Hyveet</span>
        </div>
        <div class="prep-roadmap-step" data-step="7">
          <span class="step-number">7</span>
          <span class="step-title">Paheet</span>
        </div>
        <div class="prep-roadmap-step" data-step="8">
          <span class="step-number">8</span>
          <span class="step-title">Omens</span>
        </div>
        </div>

      <div class="prep-content">

        <div class="prep-content-step" data-step-content="1">
          <h2>Vaihe 1: Killat</h2>
          <div class="guilds-step">
            <div class="guild-card card" data-guild="Faithless">
              <div class="card-header">
                <h4>Faithless</h4>
              </div>
              <div class="card-content">
                <ul>
                  <li><strong>Hyve:</strong> Ep√§usko</li>
                  <li>Voi ohittaa 1x MORAALI-tarkistuksen</li>
                </ul>
                <div class="guild-reward">
                  <strong>Palkkio:</strong> 15 Shillinki√§
                </div>
              </div>
            </div>
            <div class="guild-card card" data-guild="Merchant">
              <div class="card-header">
                <h4>Merchant</h4>
              </div>
              <div class="card-content">
                <ul>
                  <li>Aletta 25% kaikesta</li>
                </ul>
                <div class="guild-reward">
                  <strong>Palkkio:</strong> 20 Shillinki√§
                </div>
                <button id="enable-merchant-mode-btn" class="btn btn-sm" style="margin-top: 10px;">Enable Merchant Mode</button>
              </div>
            </div>
            <div class="guild-card card" data-guild="Fallen">
              <div class="card-header">
                <h4>Fallen</h4>
              </div>
              <div class="card-content">
                <div class="guild-reward">
                  <strong>Palkkio:</strong> 10 Shillinki√§
                </div>
                <table>
                  <thead>
                    <tr><th>D4</th><th>Bonus</th></tr>
                  </thead>
                  <tbody>
                    <tr><td>1</td><td>Parannettu vampyyri</td></tr>
                    <tr><td>2</td><td>Parannettu ihmissusi</td></tr>
                    <tr><td>3</td><td><strong>Hyve:</strong> Kaikki aseet hopeisia</td></tr>
                    <tr><td>4</td><td><strong>Hyve:</strong> Kostonhimoinen (+3)</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="guild-card card" data-guild="Streetfolk">
              <div class="card-header">
                <h4>Streetfolk</h4>
              </div>
              <div class="card-content">
                <ul>
                  <li><strong>Palkkio:</strong> 10 Shillinki√§</li>
                  <li><strong>Palkkio:</strong> 1 Satunainen Esine</li>
                </ul>
              </div>
            </div>
          </div>
          <div class="prep-nav">
            <button class="btn btn-secondary btn-next-step" data-next="2">Siirry seuraavaan</button>
          </div>
        </div>

        <div class="prep-content-step" data-step-content="2">
          <div class="dice-roll-section">
            <h3>Killan Nimi</h3>
            <div class="dice-roller">
              <div class="dice-indicator">d100 x 2</div>
              <div class="dice-inputs">
                <input type="number" class="d-input-square" id="guild-name-input-1" min="1" max="100" placeholder="1-100">
                <input type="number" class="d-input-square" id="guild-name-input-2" min="1" max="100" placeholder="1-100">
              </div>
            </div>
            <div class="result-display">
              <h2 id="guild-name-result"><span class="result-text">-</span></h2>
            </div>
          </div>
          <div class="table-toggle-section">
            <button id="toggle-name-tables-modal" class="btn btn-secondary"><i class="fas fa-book"></i> N√§yt√§ Taulukot</button>
          </div>
          <div class="prep-nav">
            <button class="btn btn-secondary btn-prev-step" data-prev="1"><i class="fas fa-arrow-left"></i> Edellinen</button>
            <button class="btn btn-next-step" data-next="3">Seuraava <i class="fas fa-arrow-right"></i></button>
          </div>
        </div>

        <div class="prep-content-step" data-step-content="3">
          <div class="dice-roll-section">
            <h3>Hahmon Nimi</h3>
            <div class="dice-roller">
              <div class="dice-indicator">d100</div>
              <div class="dice-inputs">
                <input type="number" class="d-input-square" id="char-name-input" min="1" max="100" placeholder="1-100">
              </div>
            </div>
            <div class="result-display">
              <h2 id="char-name-result"><span class="result-text">-</span></h2>
            </div>
          </div>
          <div class="table-toggle-section">
            <button id="toggle-char-name-table-modal" class="btn btn-secondary"><i class="fas fa-book"></i> N√§yt√§ Taulukko</button>
          </div>
          <div class="prep-nav">
            <button class="btn btn-secondary btn-prev-step" data-prev="2"><i class="fas fa-arrow-left"></i> Edellinen</button>
            <button class="btn btn-next-step" data-next="4">Seuraava <i class="fas fa-arrow-right"></i></button>
          </div>
        </div>

        <div class="prep-content-step" data-step-content="4">
          <div class="dice-roll-section">
            <h3>Ty√∂nkuvat</h3>
            <div class="dice-roller">
              <div class="dice-indicator">d100</div>
              <div class="dice-inputs">
                <input type="number" class="d-input-square" id="occupation-input" min="1" max="100" placeholder="1-100">
              </div>
            </div>
            <div class="result-display" id="occupation-result-display">
              </div>
          </div>

          <div id="occupation-reroll-section" class="dice-roll-section hidden">
            <h4>üé≤ Kaksoisvuoro! Sy√∂t√§ kaksi uutta d100-heittoa:</h4>
            <div class="dice-roller">
              <div class="dice-indicator">d100 x 2</div>
              <div class="dice-inputs">
                <input type="number" class="d-input-square" id="occupation-reroll-1" min="1" max="100" placeholder="1-100">
                <input type="number" class="d-input-square" id="occupation-reroll-2" min="1" max="100" placeholder="1-100">
              </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
              <div id="reroll-result-display-1" class="result-display"></div>
              <div id="reroll-result-display-2" class="result-display"></div>
            </div>
          </div>

          <div class="table-toggle-section">
            <button id="toggle-occupation-table-modal" class="btn btn-secondary"><i class="fas fa-book"></i> N√§yt√§ Taulukko</button>
          </div>

          <div class="prep-nav">
            <button class="btn btn-secondary btn-prev-step" data-prev="3"><i class="fas fa-arrow-left"></i> Edellinen</button>
            <button class="btn btn-next-step" data-next="5">Seuraava <i class="fas fa-arrow-right"></i></button>
          </div>
        </div>

        <div class="prep-content-step" data-step-content="5">
          <h2>Vaihe 5: Stats</h2>
          <div class="stats-display">
            <div class="stat-series-box">
              <div class="stat-series-numbers">+3, +1, 0, -3</div>
            </div>
            <div class="stat-series-box">
              <div class="stat-series-numbers">+2, +2, -1, -2</div>
            </div>
          </div>
          <div class="stat-formulas">
            <div class="formula">HP = 8 ¬± TGH</div>
            <div class="formula">Inventory = 5 ¬± STR</div>
          </div>
          <div class="prep-nav">
            <button class="btn btn-secondary btn-prev-step" data-prev="4"><i class="fas fa-arrow-left"></i> Edellinen</button>
          </div>
        </div>

        <div class="prep-content-step" data-step-content="6">
          <div class="dice-roll-section">
            <h3>Hyveet</h3>
            <div class="dice-roller">
              <div class="dice-indicator">d20</div>
              <div class="dice-inputs">
                <input type="number" class="d-input-square" id="virtue-input" min="1" max="20" placeholder="1-20">
              </div>
            </div>
            <div class="result-display" id="virtue-result-display">
              </div>
          </div>
          <div class="table-toggle-section">
            <button class="btn btn-secondary toggle-virtue-table"><i class="fas fa-book"></i> N√§yt√§ Taulukko</button>
          </div>
          <div class="prep-nav">
            <button class="btn btn-secondary btn-prev-step" data-prev="5"><i class="fas fa-arrow-left"></i> Edellinen</button>
            <button class="btn btn-next-step" data-next="7">Seuraava <i class="fas fa-arrow-right"></i></button>
          </div>
        </div>

        <div class="prep-content-step" data-step-content="7">
          <div class="dice-roll-section">
            <h3>Paheet</h3>
            <div class="dice-roller">
              <div class="dice-indicator">d20</div>
              <div class="dice-inputs">
                <input type="number" class="d-input-square" id="vice-input" min="1" max="20" placeholder="1-20">
              </div>
            </div>
            <div class="result-display" id="vice-result-display">
              </div>
          </div>
          <div class="table-toggle-section">
            <button class="btn btn-secondary toggle-vice-table"><i class="fas fa-book"></i> N√§yt√§ Taulukko</button>
          </div>
          <div class="prep-nav">
            <button class="btn btn-secondary btn-prev-step" data-prev="6"><i class="fas fa-arrow-left"></i> Edellinen</button>
            <button class="btn btn-next-step" data-next="8">Seuraava <i class="fas fa-arrow-right"></i></button>
          </div>
        </div>

        <div class="prep-content-step" data-step-content="8">
          <h2>Vaihe 8: Omens</h2>
          <div class="omens-display">
            <div class="omen-dice">
              <div class="omen-label">d4 √∑ 2</div>
              <div class="omen-label">d2</div>
            </div>
            <div class="omen-effects-box">
              <div class="effect-item">Reroll one throw</div>
              <div class="effect-item">Max damage next</div>
              <div class="effect-item">Reduce damage by d6</div>
              <div class="effect-item">Loot table reroll</div>
            </div>
          </div>
          <div class="prep-nav">
            <button class="btn btn-secondary btn-prev-step" data-prev="7"><i class="fas fa-arrow-left"></i> Edellinen</button>
            <button id="reset-roadmap-new" class="btn btn-secondary">Aloita alusta</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  
  
  <div id="tab-player-preview" class="tab-content">
    <iframe src="player.html" style="width: 100%; height: 100%; border: none;"></iframe>
  </div>

</div> <div id="name-tables-modal" class="modal-overlay">
  <div class="modal-content modal-wide">
    <button id="close-name-tables-modal" class="modal-close-btn">&times;</button>
    <h2>Killan Nimen Taulukot</h2>
    <div id="name-tables-content-modal" class="name-tables-container">
      </div>
  </div>
</div>

<div id="char-name-table-modal" class="modal-overlay">
  <div class="modal-content modal-wide">
    <button id="close-char-name-table-modal" class="modal-close-btn">&times;</button>
    <h2>Hahmon Nimen Taulukko</h2>
    <div id="char-name-table-content-modal" class="name-tables-container">
      </div>
  </div>
</div>

<div id="occupation-table-modal" class="modal-overlay">
  <div class="modal-content modal-wide">
    <button id="close-occupation-table-modal" class="modal-close-btn">&times;</button>
    <h2>Ty√∂nkuvien Taulukko</h2>
    <div id="occupation-table-content-modal" class="name-tables-container">
      </div>
  </div>
</div>

<div id="virtue-table-modal" class="modal-overlay">
  <div class="modal-content modal-wide">
    <button id="close-virtue-table-modal" class="modal-close-btn">&times;</button>
    <h2>Hyveien Taulukko (d20)</h2>
    <div id="virtue-table-content-modal" class="name-tables-container">
      </div>
  </div>
</div>

<div id="vice-table-modal" class="modal-overlay">
  <div class="modal-content modal-wide">
    <button id="close-vice-table-modal" class="modal-close-btn">&times;</button>
    <h2>Paheiden Taulukko (d20)</h2>
    <div id="vice-table-content-modal" class="name-tables-container">
      </div>
  </div>
</div>

<div id="item-details-modal" class="modal-overlay">
    <div class="modal-content">
        <button id="close-item-details-modal" class="modal-close-btn">&times;</button>
        <div id="item-details-content">
            </div>
    </div>
</div>

<div id="table-map-window" class="collapsed hidden">
  <div class="map-header">
    <span><i class="fas fa-map-location-dot"></i> Table Map</span>
    <button id="map-collapse-btn" class="btn-collapse"><i class="fas fa-chevron-up"></i></button>
  </div>
  <div class="map-content">
    <div class="map-area">
      <div class="map-token me">ME (DM)</div>
      </div>
    <div class="map-controls">
      <input type="text" id="map-token-name" placeholder="Token Name">
      <button id="add-map-token-btn" class="btn btn-sm">Add</button>
    </div>
  </div>
</div>

</body>
</html>